<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Football Analysis Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <h1>üèà Fantasy Football Analysis Dashboard</h1>
        
        <div class="nav">
            <h3>Team Management</h3>
            <button onclick="loadStandings()">League Standings</button>
            <button onclick="loadTeams()">Teams Overview</button>
            <button onclick="loadTeamsWithPlayers()">Teams & Players</button>
            
            <h3>Player Analysis</h3>
            <button onclick="loadPlayers()">All Players</button>
            <button onclick="loadAvailablePlayers()">Available Players</button>
            <button onclick="loadPlayerRankings()">Player Rankings</button>
            
            <h3>Analytics & Insights</h3>
            <button onclick="loadLeagueAnalytics()">League Analytics</button>
            <button onclick="loadPositionalAnalytics()">Positional Analysis</button>
            <button onclick="loadOptimalLineups()">Optimal Lineups</button>
            
            <h3>Matchups & Trades</h3>
            <button onclick="loadMatchups()">All Matchups</button>
            <button onclick="loadTradeProposals()">Trade Proposals</button>
            <button onclick="loadWaiverRecommendations()">Waiver Wire</button>
            
            <h3>System</h3>
            <button onclick="loadHealth()">Health Check</button>
        </div>
        
        <div class="content" id="content">
            <div class="loading">Welcome to the Fantasy Football Dashboard! Click any button above to explore the data.</div>
        </div>
    </div>

    <script>
        // Team Management Functions
        async function loadStandings() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading league standings...</div>';
            
            try {
                const response = await fetch('/api/teams/standings');
                const data = await response.json();
                
                if (data.standings && data.standings.length > 0) {
                    let html = '<h2>üèÜ League Standings</h2>';
                    html += '<table class="standings-table">';
                    html += '<tr><th>Rank</th><th>Team</th><th>Owner</th><th>Record</th><th>Points For</th><th>Points Against</th><th>Differential</th></tr>';
                    
                    data.standings.forEach(team => {
                        const record = `${team.wins}-${team.losses}${team.ties > 0 ? `-${team.ties}` : ''}`;
                        const differential = (team.points_for - team.points_against).toFixed(1);
                        
                        html += `<tr>
                            <td>${team.rank}</td>
                            <td><strong>${team.team_name}</strong></td>
                            <td>${team.owner_name}</td>
                            <td>${record}</td>
                            <td>${team.points_for.toFixed(1)}</td>
                            <td>${team.points_against.toFixed(1)}</td>
                            <td class="${differential >= 0 ? 'positive' : 'negative'}">${differential >= 0 ? '+' : ''}${differential}</td>
                        </tr>`;
                    });
                    
                    html += '</table>';
                    content.innerHTML = html;
                } else {
                    content.innerHTML = '<div class="loading">No standings found</div>';
                }
            } catch (error) {
                content.innerHTML = '<div class="error">Error loading standings: ' + error.message + '</div>';
            }
        }

        async function loadTeams() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading teams...</div>';
            
            try {
                const response = await fetch('/api/teams');
                const data = await response.json();
                
                if (data.teams && data.teams.length > 0) {
                    const table = createTable(data.teams, ['team_name', 'owner_name', 'wins', 'losses', 'ties', 'points_for']);
                    content.innerHTML = '<h2>Fantasy Teams</h2>' + table;
                } else {
                    content.innerHTML = '<div class="loading">No teams found</div>';
                }
            } catch (error) {
                content.innerHTML = '<div class="error">Error loading teams: ' + error.message + '</div>';
            }
        }

        async function loadTeamsWithPlayers() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading teams with players...</div>';
            
            try {
                const response = await fetch('/api/teams-with-players');
                const data = await response.json();
                
                if (data.teams && data.teams.length > 0) {
                    let html = '<h2>Teams & Rosters</h2>';
                    data.teams.forEach(team => {
                        html += `<div class="team-card">
                            <h3>${team.team_name} (${team.owner_name})</h3>
                            <p>Record: ${team.wins}-${team.losses}-${team.ties} | Points: ${team.points_for.toFixed(1)}</p>
                            <p>Players: ${team.player_count} | Roster: ${Object.entries(team.roster_composition || {}).map(([pos, count]) => `${pos}: ${count}`).join(', ')}</p>
                        </div>`;
                    });
                    content.innerHTML = html;
                } else {
                    content.innerHTML = '<div class="loading">No teams found</div>';
                }
            } catch (error) {
                content.innerHTML = '<div class="error">Error loading teams with players: ' + error.message + '</div>';
            }
        }

        // Player Analysis Functions
        async function loadPlayers() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading players...</div>';
            
            try {
                const response = await fetch('/api/players');
                const data = await response.json();
                
                if (data.players && data.players.length > 0) {
                    const table = createTable(data.players, ['name', 'position', 'nfl_team_id', 'is_active']);
                    content.innerHTML = '<h2>All Players</h2>' + table;
                } else {
                    content.innerHTML = '<div class="loading">No players found</div>';
                }
            } catch (error) {
                content.innerHTML = '<div class="error">Error loading players: ' + error.message + '</div>';
            }
        }

        async function loadAvailablePlayers() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading available players...</div>';
            
            try {
                const response = await fetch('/api/players/available');
                const data = await response.json();
                
                let html = `<h2>üí∞ Available Players (${data.total_available})</h2>`;
                
                if (data.total_available > 0) {
                    for (const [position, players] of Object.entries(data.available_by_position)) {
                        html += `<h3>${position} (${players.length})</h3>`;
                        html += '<div class="player-grid">';
                        players.slice(0, 10).forEach(player => {
                            html += `<div class="player-card">
                                <strong>${player.name}</strong><br>
                                ${player.nfl_team_name || 'Free Agent'}
                            </div>`;
                        });
                        html += '</div>';
                    }
                } else {
                    html += '<p>All players are currently rostered!</p>';
                }
                
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = '<div class="error">Error loading available players: ' + error.message + '</div>';
            }
        }

        async function loadPlayerRankings() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading player rankings...</div>';
            
            try {
                const response = await fetch('/api/players/rankings');
                const data = await response.json();
                
                let html = '<h2>üìä Player Rankings</h2>';
                
                if (data.rankings.length > 0) {
                    for (const [position, rankings] of Object.entries(data.rankings_by_position)) {
                        html += `<h3>${position}</h3>`;
                        html += '<ol class="ranking-list">';
                        rankings.slice(0, 10).forEach(ranking => {
                            html += `<li>
                                <strong>${ranking.name}</strong> 
                                ${ranking.nfl_team_name ? `(${ranking.nfl_team_code})` : ''}
                                ${ranking.tier ? `- Tier ${ranking.tier}` : ''}
                            </li>`;
                        });
                        html += '</ol>';
                    }
                } else {
                    html += '<p>No rankings data available.</p>';
                }
                
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = '<div class="error">Error loading player rankings: ' + error.message + '</div>';
            }
        }

        // Analytics Functions
        async function loadLeagueAnalytics() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading league analytics...</div>';
            
            try {
                const response = await fetch('/api/analytics/league');
                const data = await response.json();
                const analytics = data.analytics;
                
                let html = '<h2>üìà League Analytics</h2>';
                html += '<div class="analytics-grid">';
                
                html += `<div class="stat-card">
                    <h3>League Overview</h3>
                    <p><strong>${analytics.league_summary.total_teams}</strong> Teams</p>
                    <p><strong>${analytics.league_summary.total_active_players}</strong> Active Players</p>
                    <p><strong>${analytics.league_summary.total_points_scored.toFixed(1)}</strong> Total Points</p>
                    <p><strong>${analytics.league_summary.league_average_points.toFixed(1)}</strong> Avg Points/Team</p>
                </div>`;
                
                html += '<div class="stat-card">';
                html += '<h3>Position Distribution</h3>';
                for (const [position, count] of Object.entries(analytics.position_distribution)) {
                    html += `<p>${position}: <strong>${count}</strong></p>`;
                }
                html += '</div>';
                
                if (analytics.highest_scoring_team) {
                    html += `<div class="stat-card">
                        <h3>League Leaders</h3>
                        <p>üî• Highest Scoring: <strong>${analytics.highest_scoring_team}</strong></p>
                        <p>‚ùÑÔ∏è Lowest Scoring: <strong>${analytics.lowest_scoring_team}</strong></p>
                    </div>`;
                }
                
                html += '</div>';
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = '<div class="error">Error loading league analytics: ' + error.message + '</div>';
            }
        }

        async function loadPositionalAnalytics() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading positional analytics...</div>';
            
            try {
                const response = await fetch('/api/analytics/positional');
                const data = await response.json();
                
                let html = '<h2>üéØ Positional Scarcity Analysis</h2>';
                html += '<table class="analytics-table">';
                html += '<tr><th>Position</th><th>Total Players</th><th>Rostered</th><th>Available</th><th>Scarcity Rating</th></tr>';
                
                data.positional_analysis.forEach(pos => {
                    const scarcityClass = pos.scarcity_rating === 'High' ? 'high-scarcity' : 
                                         pos.scarcity_rating === 'Medium' ? 'medium-scarcity' : 'low-scarcity';
                    
                    html += `<tr>
                        <td><strong>${pos.position}</strong></td>
                        <td>${pos.total_players}</td>
                        <td>${pos.rostered_players}</td>
                        <td>${pos.available_players}</td>
                        <td class="${scarcityClass}">${pos.scarcity_rating}</td>
                    </tr>`;
                });
                
                html += '</table>';
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = '<div class="error">Error loading positional analytics: ' + error.message + '</div>';
            }
        }

        async function loadOptimalLineups() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading optimal lineups...</div>';
            
            try {
                const response = await fetch('/api/analytics/optimal-lineups');
                const data = await response.json();
                
                let html = '<h2>‚ö° Optimal Lineup Suggestions</h2>';
                
                data.optimal_lineups.forEach(team => {
                    html += `<div class="team-card">
                        <h3>${team.team_name}</h3>`;
                    
                    if (Object.keys(team.optimal_lineup).length > 0) {
                        html += '<div class="lineup-grid">';
                        for (const [position, player] of Object.entries(team.optimal_lineup)) {
                            const projectedPoints = player.projected_fantasy_points ? 
                                ` (${player.projected_fantasy_points.toFixed(1)} pts)` : '';
                            html += `<div class="player-slot">
                                <strong>${position}</strong><br>
                                ${player.name}${projectedPoints}
                            </div>`;
                        }
                        html += '</div>';
                    } else {
                        html += '<p>No roster data available</p>';
                    }
                    
                    html += '</div>';
                });
                
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = '<div class="error">Error loading optimal lineups: ' + error.message + '</div>';
            }
        }

        // Matchup and Trade Functions
        async function loadMatchups() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading matchups...</div>';
            
            try {
                const response = await fetch('/api/matchups');
                const data = await response.json();
                
                let html = `<h2>üèüÔ∏è Fantasy Matchups (${data.total_matchups})</h2>`;
                
                if (data.total_matchups > 0) {
                    for (const [week, matchups] of Object.entries(data.matchups_by_week)) {
                        html += `<h3>Week ${week}</h3>`;
                        html += '<div class="matchup-grid">';
                        matchups.forEach(matchup => {
                            html += `<div class="matchup-card">
                                <div class="matchup-teams">
                                    ${matchup.home_team_name} vs ${matchup.away_team_name}
                                </div>
                                <div class="matchup-score">
                                    ${matchup.home_score.toFixed(1)} - ${matchup.away_score.toFixed(1)}
                                </div>
                            </div>`;
                        });
                        html += '</div>';
                    }
                } else {
                    html += '<p>No matchup data available.</p>';
                }
                
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = '<div class="error">Error loading matchups: ' + error.message + '</div>';
            }
        }

        async function loadTradeProposals() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading trade proposals...</div>';
            
            try {
                const response = await fetch('/api/trades/proposals');
                const data = await response.json();
                
                let html = `<h2>üîÑ Trade Proposals (${data.total_proposals})</h2>`;
                
                if (data.total_proposals > 0) {
                    data.proposals.forEach(proposal => {
                        html += `<div class="trade-card">
                            <h4>${proposal.proposing_team_name} ‚Üî ${proposal.receiving_team_name}</h4>
                            <p>Status: <span class="status-${proposal.status.toLowerCase()}">${proposal.status}</span></p>
                            <p>Proposed: ${new Date(proposal.proposed_date).toLocaleDateString()}</p>
                        </div>`;
                    });
                } else {
                    html += '<p>No trade proposals found.</p>';
                }
                
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = '<div class="error">Error loading trade proposals: ' + error.message + '</div>';
            }
        }

        async function loadWaiverRecommendations() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading waiver recommendations...</div>';
            
            try {
                const response = await fetch('/api/waivers/recommendations');
                const data = await response.json();
                
                let html = `<h2>üìã Waiver Wire Recommendations (${data.total_recommendations})</h2>`;
                
                if (data.total_recommendations > 0) {
                    for (const [position, players] of Object.entries(data.recommendations_by_position)) {
                        if (players.length > 0) {
                            html += `<h3>${position} Recommendations</h3>`;
                            html += '<div class="waiver-grid">';
                            players.forEach(player => {
                                const projectedPoints = player.projected_fantasy_points ? 
                                    ` (${player.projected_fantasy_points.toFixed(1)} pts)` : '';
                                const ranking = player.rank ? ` #${player.rank}` : '';
                                
                                html += `<div class="waiver-card">
                                    <strong>${player.name}${ranking}</strong><br>
                                    ${player.nfl_team_name || 'Free Agent'}${projectedPoints}
                                </div>`;
                            });
                            html += '</div>';
                        }
                    }
                } else {
                    html += '<p>No waiver recommendations available.</p>';
                }
                
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = '<div class="error">Error loading waiver recommendations: ' + error.message + '</div>';
            }
        }

        async function loadHealth() {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Checking system health...</div>';
            
            try {
                const response = await fetch('/health');
                const data = await response.json();
                
                content.innerHTML = `<h2>System Health ‚úÖ</h2>
                    <p><strong>Status:</strong> ${data.status}</p>
                    <p><strong>Database:</strong> ${data.database}</p>`;
            } catch (error) {
                content.innerHTML = '<div class="error">Error checking health: ' + error.message + '</div>';
            }
        }

        function createTable(data, columns) {
            if (!data || data.length === 0) return '<p>No data available</p>';
            
            let table = '<table><thead><tr>';
            columns.forEach(col => table += `<th>${col.replace('_', ' ').toUpperCase()}</th>`);
            table += '</tr></thead><tbody>';
            
            data.forEach(row => {
                table += '<tr>';
                columns.forEach(col => {
                    let value = row[col];
                    if (typeof value === 'number') value = value.toFixed(1);
                    table += `<td>${value || 'N/A'}</td>`;
                });
                table += '</tr>';
            });
            
            table += '</tbody></table>';
            return table;
        }

        // Load standings by default
        window.onload = function() {
            loadStandings();
        };
    </script>
</body>
</html>